<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Liar's Dice Calculator</title>
    <style>
        body { font-family: -apple-system, sans-serif; padding: 20px; }
        input, button { padding: 10px; margin: 5px 0; width: 100%; }
        .result { margin-top: 20px; font-weight: bold; }
        .error { color: red; }
        .suggestion { margin-top: 15px; padding: 10px; background-color: #f0f0f0; border-radius: 5px; }
        .section { margin-top: 20px; border-top: 1px solid #ddd; padding-top: 15px; }
    </style>
</head>
<body>
    <h2>üé≤ Liar's Dice Calculator</h2>

    <label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–≥—Ä–æ–∫–æ–≤:</label>
    <input type="number" id="players" min="2" value="3">

    <label>–í–∞—à–∏ –∫—É–±–∏–∫–∏ (5 —Ü–∏—Ñ—Ä –æ—Ç 1 –¥–æ 6, –Ω–∞–ø—Ä–∏–º–µ—Ä 12132):</label>
    <input type="text" id="dice" placeholder="12132" value="12132" maxlength="5">

    <label>–ó–∞—è–≤–∫–∞ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä "5 5" - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏ –∑–Ω–∞—á–µ–Ω–∏–µ):</label>
    <input type="text" id="claim" placeholder="4 2" value="4 2">

    <button onclick="calculateAll()">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å</button>

    <div id="error" class="error"></div>
    
    <div id="probabilityResult" class="result"></div>
    
    <div class="section">
        <h3>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –¥–ª—è –≤–∞—à–µ–≥–æ —Ö–æ–¥–∞</h3>
        <div id="suggestion" class="suggestion"></div>
    </div>

    <script>
        function calculateAll() {
            try {
                // –û—á–∏—Å—Ç–∫–∞ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
                document.getElementById('error').textContent = '';
                document.getElementById('probabilityResult').textContent = '';
                document.getElementById('suggestion').textContent = '';
                
                // –ü–æ–ª—É—á–µ–Ω–∏–µ –≤–≤–æ–¥–∞
                const numPlayers = parseInt(document.getElementById('players').value);
                if (isNaN(numPlayers)) throw new Error("–í–≤–µ–¥–∏—Ç–µ —á–∏—Å–ª–æ –∏–≥—Ä–æ–∫–æ–≤");
                if (numPlayers < 2) throw new Error("–ú–∏–Ω–∏–º—É–º 2 –∏–≥—Ä–æ–∫–∞");
                
                const diceInput = document.getElementById('dice').value.trim();
                if (!diceInput) throw new Error("–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–∏ –∫—É–±–∏–∫–∏");
                if (diceInput.length !== 5) throw new Error("–í–≤–µ–¥–∏—Ç–µ —Ä–æ–≤–Ω–æ 5 —Ü–∏—Ñ—Ä");
                
                const myDice = diceInput.split('').map(Number);
                if (myDice.some(isNaN) || myDice.some(d => d < 1 || d > 6)) {
                    throw new Error("–í–≤–µ–¥–∏—Ç–µ —Ü–∏—Ñ—Ä—ã –æ—Ç 1 –¥–æ 6");
                }
                
                const claimInput = document.getElementById('claim').value.trim();
                if (!claimInput) throw new Error("–í–≤–µ–¥–∏—Ç–µ –∑–∞—è–≤–∫—É –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞");
                
                const claim = claimInput.split(/\s+/).map(Number);
                if (claim.length !== 2 || claim.some(isNaN) || claim[1] < 1 || claim[1] > 6) {
                    throw new Error("–ó–∞—è–≤–∫–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≤ —Ñ–æ—Ä–º–∞—Ç–µ '–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–Ω–∞—á–µ–Ω–∏–µ' (–∑–Ω–∞—á–µ–Ω–∏–µ 1-6)");
                }

                // 1. –†–∞—Å—á–µ—Ç –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ —Ç–µ–∫—É—â–µ–π –∑–∞—è–≤–∫–∏
                const [prob, counted] = calcProbability(numPlayers, myDice, claim);
                
                let probResult = `–ê–Ω–∞–ª–∏–∑ –∑–∞—è–≤–∫–∏ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞ (${claim[0]} ${claim[1]}):<br>`;
                probResult += `–£ –≤–∞—Å: ${counted} ${claim[1]} (${counted - myDice.filter(d => d === 1).length} —Ä–µ–∞–ª—å–Ω—ã—Ö + ${myDice.filter(d => d === 1).length} wildcard)<br>`;
                probResult += `–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å ${claim[0]}+ ${claim[1]}: <b>${(prob * 100).toFixed(2)}%</b>`;

                if (prob >= 0.95) probResult += "<br>üî¥ –ü–æ—á—Ç–∏ –Ω–∞–≤–µ—Ä–Ω—è–∫–∞ –ø—Ä–∞–≤–¥–∞!";
                else if (prob <= 0.05) probResult += "<br>üü¢ –°–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ –±–ª–µ—Ñ!";
                else if (prob <= 0.3) probResult += "<br>üü¢ –í–µ—Ä–æ—è—Ç–Ω–æ –±–ª–µ—Ñ";
                else if (prob >= 0.7) probResult += "<br>üî¥ –í–µ—Ä–æ—è—Ç–Ω–æ –ø—Ä–∞–≤–¥–∞";

                document.getElementById('probabilityResult').innerHTML = probResult;

                // 2. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –≤–∞—à–µ–≥–æ —Ö–æ–¥–∞
                const suggestions = generateSuggestions(numPlayers, myDice, claim);
                
                if (suggestions.length === 0) {
                    document.getElementById('suggestion').innerHTML = 
                        "<b>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:</b> –û—Å–ø–æ—Ä–∏—Ç—å –∑–∞—è–≤–∫—É!<br>" +
                        "–ù–µ—Ç —Ö–æ—Ä–æ—à–∏—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –¥–ª—è –ø–æ–≤—ã—à–µ–Ω–∏—è —Å—Ç–∞–≤–∫–∏";
                    return;
                }

                // –í—ã–±–∏—Ä–∞–µ–º –ª—É—á—à—É—é –∑–∞—è–≤–∫—É (—Å –Ω–∞–∏–º–µ–Ω—å—à–µ–π –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å—é –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ –∏–≥—Ä–æ–∫–∞)
                const bestSuggestion = suggestions.reduce((best, curr) => 
                    curr.nextPlayerProb < best.nextPlayerProb ? curr : best
                );

                let suggestionText = `<b>–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è –∑–∞—è–≤–∫–∞:</b> ${bestSuggestion.quantity} ${bestSuggestion.value}<br>`;
                suggestionText += `–û—Å–Ω–æ–≤–∞–Ω–∏–µ: —É –≤–∞—Å ${bestSuggestion.myCount} (${bestSuggestion.myReal} —Ä–µ–∞–ª—å–Ω—ã—Ö + ${bestSuggestion.myWild} wildcard)<br>`;
                suggestionText += `–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –∏—Å—Ç–∏–Ω–Ω–æ—Å—Ç–∏: <b>${(bestSuggestion.claimProbability * 100).toFixed(2)}%</b> `;
                suggestionText += bestSuggestion.claimProbability > 0.7 ? "üü¢" : bestSuggestion.claimProbability > 0.4 ? "üü°" : "üî¥";
                suggestionText += `<br>–®–∞–Ω—Å –æ–ø—Ä–æ–≤–µ—Ä–∂–µ–Ω–∏—è: <b>${(bestSuggestion.nextPlayerProb * 100).toFixed(2)}%</b> `;
                suggestionText += bestSuggestion.nextPlayerProb < 0.3 ? "üî¥" : bestSuggestion.nextPlayerProb < 0.6 ? "üü°" : "üü¢";

                // –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã
                if (suggestions.length > 1) {
                    suggestionText += "<br><br><b>–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã:</b>";
                    suggestions.slice(0, 3).forEach(sugg => {
                        const riskLevel = sugg.nextPlayerProb < 0.4 ? "üü¢" : sugg.nextPlayerProb < 0.7 ? "üü°" : "üî¥";
                        suggestionText += `<br>${riskLevel} ${sugg.quantity} ${sugg.value} (–∏—Å—Ç–∏–Ω–Ω–æ—Å—Ç—å: ${(sugg.claimProbability * 100).toFixed(2)}%, –æ–ø—Ä–æ–≤–µ—Ä–∂–µ–Ω–∏–µ: ${(sugg.nextPlayerProb * 100).toFixed(2)}%)`;
                    });
                }

                // –î–æ–±–∞–≤–ª—è–µ–º –≤–∞—Ä–∏–∞–Ω—Ç "–æ—Å–ø–æ—Ä–∏—Ç—å"
                suggestionText += `<br><br><b>–ò–ª–∏ –æ—Å–ø–æ—Ä–∏—Ç—å:</b> —à–∞–Ω—Å —á—Ç–æ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫ –±–ª–µ—Ñ—É–µ—Ç - ${((1-prob)*100).toFixed(2)}%`;

                document.getElementById('suggestion').innerHTML = suggestionText;
            } catch (error) {
                document.getElementById('error').textContent = error.message;
            }
        }

        function generateSuggestions(numPlayers, myDice, lastClaim) {
            const [lastQuantity, lastValue] = lastClaim;
            const suggestions = [];
            
            // –í–æ–∑–º–æ–∂–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –¥–ª—è –∑–∞—è–≤–∫–∏
            const possibleValues = lastValue === 6 ? [6] : [lastValue, lastValue + 1];
            const possibleQuantities = [lastQuantity + 1, lastQuantity + 2];
            
            // –ü–µ—Ä–µ–±–∏—Ä–∞–µ–º –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏
            for (const value of possibleValues) {
                for (const quantity of possibleQuantities) {
                    if (quantity <= numPlayers * 5) { // –ù–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –±–æ–ª—å—à–µ –æ–±—â–µ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∫—É–±–∏–∫–æ–≤
                        // –°–∫–æ–ª—å–∫–æ —É –Ω–∞—Å —Ç–∞–∫–∏—Ö –∫—É–±–∏–∫–æ–≤
                        const myReal = myDice.filter(d => d === value).length;
                        const myWild = value !== 1 ? myDice.filter(d => d === 1).length : 0;
                        const myCount = myReal + myWild;
                        
                        // –ï—Å–ª–∏ –∑–∞—è–≤–∫–∞ –º–µ–Ω—å—à–µ —á–µ–º —É –Ω–∞—Å –µ—Å—Ç—å, –Ω–µ –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º
                        if (quantity <= myCount) continue;
                        
                        // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –∏—Å—Ç–∏–Ω–Ω–æ—Å—Ç–∏ –∑–∞—è–≤–∫–∏
                        const claimProbability = calcProbability(numPlayers, myDice, [quantity, value])[0];
                        
                        // –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ –∏–≥—Ä–æ–∫–∞
                        const nextPlayerProb = 1 - claimProbability;
                        
                        suggestions.push({
                            value,
                            quantity,
                            myReal,
                            myWild,
                            myCount,
                            claimProbability,
                            nextPlayerProb
                        });
                    }
                }
            }
            
            return suggestions.sort((a, b) => a.nextPlayerProb - b.nextPlayerProb);
        }

        function calcProbability(numPlayers, myDice, claim) {
            const [claimedNum, claimedValue] = claim;
            const totalDice = numPlayers * 5;
            const unknownDice = totalDice - 5;

            const myReal = myDice.filter(d => d === claimedValue).length;
            const myWild = claimedValue !== 1 ? myDice.filter(d => d === 1).length : 0;
            const myCount = myReal + myWild;

            const needed = Math.max(0, claimedNum - myCount);

            if (needed > unknownDice) return [0, myCount];

            const p = claimedValue !== 1 ? 2/6 : 1/6;
            let probability = 0;

            for (let k = needed; k <= unknownDice; k++) {
                probability += binomial(unknownDice, k, p);
            }

            probability = Math.max(0, Math.min(1, probability));
            
            return [probability, myCount];
        }

        function binomial(n, k, p) {
            if (k < 0 || k > n) return 0;
            return comb(n, k) * Math.pow(p, k) * Math.pow(1 - p, n - k);
        }

        function comb(n, k) {
            if (k < 0 || k > n) return 0;
            if (k === 0 || k === n) return 1;
            k = Math.min(k, n - k); // –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
            let res = 1;
            for (let i = 1; i <= k; i++) {
                res *= (n - k + i) / i;
            }
            return res;
        }
    </script>
</body>
</html>